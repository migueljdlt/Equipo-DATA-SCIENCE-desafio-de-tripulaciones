<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Home</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Home</h1>

    



    


    <h3> </h3>










    




    <section>
        <article><h1>Chatbot SQL + Charts ğŸ“Š</h1>
<p>Sistema de chatbot conversacional para consultas SQL con generaciÃ³n automÃ¡tica de grÃ¡ficos usando IA.</p>
<h2>ğŸš€ CaracterÃ­sticas</h2>
<ul>
<li><strong>GeneraciÃ³n de SQL con IA</strong>: Usa Ollama + Qwen3 para convertir lenguaje natural en SQL</li>
<li><strong>GrÃ¡ficos automÃ¡ticos</strong>: Genera pie charts, barras, lÃ­neas y columnas en formato base64</li>
<li><strong>Arquitectura modular</strong>: Node.js + Flask API + PostgreSQL</li>
<li><strong>MCP Protocol</strong>: IntegraciÃ³n con Model Context Protocol de Anthropic</li>
<li><strong>Base de datos real</strong>: PostgreSQL en Render</li>
<li><strong>Sistema de aprendizaje</strong>: Cache de consultas exitosas para mejorar generaciÃ³n SQL</li>
<li><strong>Glosarios matemÃ¡ticos</strong>: Soporte para operaciones matemÃ¡ticas complejas (porcentajes, promedios, rankings)</li>
</ul>
<h2>ğŸ› ï¸ TecnologÃ­as</h2>
<h3>Backend (Node.js)</h3>
<ul>
<li>Express.js v4.18.2</li>
<li>MCP SDK v1.0.0 (Model Context Protocol)</li>
<li>Chart.js v4.4.6 + chartjs-node-canvas v5.0.0</li>
<li>PostgreSQL (pg v8.16.3)</li>
<li>Ollama API</li>
<li>dotenv v16.0.0</li>
</ul>
<h3>API (Flask)</h3>
<ul>
<li>Flask v3.1.2</li>
<li>Flask-CORS v6.0.2</li>
<li>Requests v2.32.3</li>
</ul>
<h3>Base de datos</h3>
<ul>
<li>PostgreSQL (Render)</li>
<li><strong>Tablas</strong>:
<ul>
<li><code>employees</code> - Empleados</li>
<li><code>customers</code> - Clientes</li>
<li><code>products</code> - Productos</li>
<li><code>sales</code> - Ventas</li>
</ul>
</li>
</ul>
<h3>IA/ML</h3>
<ul>
<li>Ollama (servidor local)</li>
<li>Modelo: Qwen3:8b</li>
</ul>
<h2>ğŸ“¦ InstalaciÃ³n</h2>
<h3>Requisitos previos</h3>
<ul>
<li>Node.js v24.x o superior</li>
<li>Python 3.13+</li>
<li>Ollama instalado localmente</li>
<li>Acceso a base de datos PostgreSQL</li>
</ul>
<h3>1. Clonar repositorio</h3>
<pre class="prettyprint source lang-bash"><code>git clone https://github.com/migueljdlt/Archivo-Desaf-o-DATA-SCIENCE.git
cd Archivo-Desaf-o-DATA-SCIENCE
</code></pre>
<h3>2. Configurar variables de entorno</h3>
<p>Copia <code>.env.example</code> a <code>.env</code> y configura tus credenciales:</p>
<pre class="prettyprint source lang-bash"><code>cp .env.example .env
</code></pre>
<p>Edita <code>.env</code> con tus valores:</p>
<pre class="prettyprint source lang-env"><code>PORT=3001
DATABASE_URL=postgresql://usuario:password@host:5432/database
OLLAMA_URL=http://localhost:11434
OLLAMA_MODEL=qwen3:8b
</code></pre>
<h3>3. Instalar dependencias Node.js</h3>
<pre class="prettyprint source lang-bash"><code>npm install --legacy-peer-deps
</code></pre>
<h3>4. Instalar dependencias Python</h3>
<pre class="prettyprint source lang-bash"><code># Crear entorno virtual
python -m venv venv_flask

# Activar entorno virtual
# Windows:
.\venv_flask\Scripts\activate
# Linux/Mac:
source venv_flask/bin/activate

# Instalar dependencias
pip install -r requirements.txt
</code></pre>
<h3>5. Instalar y configurar Ollama</h3>
<pre class="prettyprint source lang-bash"><code># Descargar desde https://ollama.ai

# Descargar modelo Qwen3
ollama pull qwen3:8b

# Verificar que funciona
ollama run qwen3:8b &quot;Hola&quot;
</code></pre>
<h2>ğŸš€ Uso</h2>
<h3>Iniciar servicios</h3>
<h4>Terminal 1 - Ollama (debe estar corriendo primero)</h4>
<pre class="prettyprint source lang-bash"><code># Ya estÃ¡ corriendo como servicio en segundo plano
# Si no, ejecuta: ollama serve
</code></pre>
<h4>Terminal 2 - Node.js Server</h4>
<pre class="prettyprint source lang-bash"><code>node server.js
</code></pre>
<p>DeberÃ­as ver:</p>
<pre class="prettyprint source"><code>============================================================
   CHATBOT SQL + CHARTS - BASE DE DATOS RENDER
============================================================
>> API: http://localhost:3001
>> BD: database_final_project (Render)
>> Graficos: bar, column, line, pie
</code></pre>
<h4>Terminal 3 - Flask API</h4>
<pre class="prettyprint source lang-bash"><code># Activar entorno virtual
.\venv_flask\Scripts\activate  # Windows
source venv_flask/bin/activate  # Linux/Mac

# Iniciar Flask
python Flask_API/app.py
</code></pre>
<p>DeberÃ­as ver:</p>
<pre class="prettyprint source"><code>============================================================
   FLASK API - CHATBOT DE VENTAS
============================================================
Flask API:        http://localhost:5000
</code></pre>
<h3>Hacer una consulta</h3>
<pre class="prettyprint source lang-python"><code>import requests

response = requests.post(
    &quot;http://localhost:5000/api/chat&quot;,
    json={
        &quot;message&quot;: &quot;Dame un grÃ¡fico pie chart de ventas por mes&quot;,
        &quot;usuario_id&quot;: &quot;test&quot;,
        &quot;rol&quot;: &quot;ventas&quot;
    },
    timeout=60
)

result = response.json()
print(f&quot;SQL generado: {result['sql_generado']}&quot;)
print(f&quot;Tiene grÃ¡fica: {result['tiene_grafica']}&quot;)

# La imagen estÃ¡ en base64
if result['grafica_base64']:
    import base64
    from PIL import Image
    from io import BytesIO
    
    base64_str = result['grafica_base64'].split(',')[1]
    image_data = base64.b64decode(base64_str)
    image = Image.open(BytesIO(image_data))
    image.save('grafico.png')
    print(&quot; GrÃ¡fico guardado como 'grafico.png'&quot;)
</code></pre>
<h2>ğŸ“¡ Endpoints</h2>
<h3>Flask API (Puerto 5000)</h3>
<h4>POST <code>/api/chat</code></h4>
<p>Enviar consulta al chatbot</p>
<p><strong>Request:</strong></p>
<pre class="prettyprint source lang-json"><code>{
  &quot;message&quot;: &quot;Â¿CuÃ¡ntas ventas hay en enero?&quot;,
  &quot;usuario_id&quot;: &quot;test&quot;,
  &quot;rol&quot;: &quot;ventas&quot;
}
</code></pre>
<p><strong>Response:</strong></p>
<pre class="prettyprint source lang-json"><code>{
  &quot;exito&quot;: true,
  &quot;session_id&quot;: &quot;uuid&quot;,
  &quot;mensaje&quot;: &quot;Se encontraron 150 ventas en enero&quot;,
  &quot;sql_generado&quot;: &quot;SELECT COUNT(*) FROM sales WHERE...&quot;,
  &quot;datos&quot;: [{&quot;count&quot;: 150}],
  &quot;columnas&quot;: [&quot;count&quot;],
  &quot;total_filas&quot;: 1,
  &quot;tipo_grafica&quot;: null,
  &quot;tiene_grafica&quot;: false,
  &quot;grafica_base64&quot;: null
}
</code></pre>
<h4>GET <code>/health</code></h4>
<p>Health check del sistema</p>
<h4>GET <code>/api/schema</code></h4>
<p>Obtener schema de la base de datos</p>
<h4>GET <code>/api/ejemplos</code></h4>
<p>Obtener ejemplos de consultas</p>
<h3>Node.js Server (Puerto 3001)</h3>
<h4>POST <code>/api/query</code></h4>
<p>Procesar query SQL directamente</p>
<h4>POST <code>/api/chart</code></h4>
<p>Generar grÃ¡fico desde datos</p>
<h4>GET <code>/api/chart/types</code></h4>
<p>Tipos de grÃ¡ficos disponibles</p>
<h2> Ejemplos de consultas</h2>
<p>El chatbot entiende lenguaje natural:</p>
<pre class="prettyprint source"><code> &quot;Â¿CuÃ¡ntas ventas hay en total?&quot;
 &quot;Top 5 empleados con mÃ¡s ventas&quot;
 &quot;GrÃ¡fico de barras de ventas por producto&quot;
 &quot;Dame un pie chart de ventas por mÃ©todo de pago&quot;
 &quot;Calcula el 5% de las ventas totales&quot;
 &quot;Â¿CuÃ¡l es el promedio de ventas por empleado?&quot;
 &quot;Ventas que superan el promedio&quot;
 &quot;ParticipaciÃ³n porcentual de cada regiÃ³n&quot;
 &quot;GrÃ¡fico de lÃ­neas de ventas por mes&quot;
 &quot;Top 10% de productos mÃ¡s vendidos&quot;
</code></pre>
<h2>ğŸ—ï¸ Estructura del proyecto</h2>
<pre class="prettyprint source"><code>Archivo-Desaf-o-DATA-SCIENCE/
â”‚
â”œâ”€â”€ .env                      # Variables de entorno (NO SUBIR)
â”œâ”€â”€ .env.example             # Template de variables
â”œâ”€â”€ .gitignore               # Archivos ignorados por Git
â”œâ”€â”€ package.json             # Dependencias Node.js
â”œâ”€â”€ requirements.txt         # Dependencias Python
â”œâ”€â”€ server.js                # Punto de entrada Node.js
â”œâ”€â”€ README.md                # Este archivo
â”‚
â”œâ”€â”€ src/                     # Backend Node.js
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ constants.js     # Schema, glosarios, tipos
â”‚   â”‚   â”œâ”€â”€ database.js      # Config PostgreSQL
â”‚   â”‚   â””â”€â”€ ollama.js        # Config Ollama
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ mcpClient.js     # Cliente MCP PostgreSQL
â”‚   â”‚   â”œâ”€â”€ ollamaService.js # Servicio Ollama
â”‚   â”‚   â””â”€â”€ sqlService.js    # GeneraciÃ³n y formateo SQL
â”‚   â”‚
â”‚   â”œâ”€â”€ charts/
â”‚   â”‚   â”œâ”€â”€ chartGenerator.js # Generador de grÃ¡ficos
â”‚   â”‚   â””â”€â”€ chartUtils.js     # Utilidades grÃ¡ficos
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ index.js         # Router principal
â”‚   â”‚   â”œâ”€â”€ queryRoutes.js   # Rutas de consultas
â”‚   â”‚   â”œâ”€â”€ chartRoutes.js   # Rutas de grÃ¡ficos
â”‚   â”‚   â””â”€â”€ infoRoutes.js    # Info y metadata
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ sqlValidator.js  # ValidaciÃ³n SQL
â”‚   â”‚   â”œâ”€â”€ dataFormatter.js # Formateo datos
â”‚   â”‚   â””â”€â”€ helpers.js       # Funciones auxiliares
â”‚   â”‚
â”‚   â””â”€â”€ app.js               # App Express principal
â”‚
â””â”€â”€ Flask_API/               # API Flask
    â”œâ”€â”€ config/
    â”‚   â””â”€â”€ settings.py      # ConfiguraciÃ³n Flask
    â”‚
    â”œâ”€â”€ routes/
    â”‚   â”œâ”€â”€ chat.py          # Endpoint principal
    â”‚   â”œâ”€â”€ health.py        # Health checks
    â”‚   â””â”€â”€ metadata.py      # Schema y ejemplos
    â”‚
    â”œâ”€â”€ services/
    â”‚   â””â”€â”€ mcp_client.py    # Cliente Node.js
    â”‚
    â”œâ”€â”€ utils/
    â”‚   â”œâ”€â”€ formatter.py     # Formato de respuestas
    â”‚   â””â”€â”€ session.py       # GestiÃ³n de sesiones
    â”‚
    â””â”€â”€ app.py               # App Flask principal
</code></pre>
<h2>ğŸ”§ Troubleshooting</h2>
<h3>Error: &quot;Cannot find module 'dotenv'&quot;</h3>
<pre class="prettyprint source lang-bash"><code>npm install dotenv --legacy-peer-deps
</code></pre>
<h3>Error: &quot;Puerto 3001 en uso&quot;</h3>
<pre class="prettyprint source lang-powershell"><code># Windows
netstat -ano | findstr :3001
taskkill /PID &lt;PID> /F

# Linux/Mac
lsof -ti:3001 | xargs kill -9
</code></pre>
<h3>Error: &quot;Ollama no responde&quot;</h3>
<pre class="prettyprint source lang-bash"><code># Verificar que Ollama estÃ¡ corriendo
ollama list

# Reiniciar Ollama
# Windows: Cerrar desde el systray y abrir de nuevo
# Linux/Mac: systemctl restart ollama
</code></pre>
<h3>GrÃ¡ficos no se generan</h3>
<ol>
<li>Verificar que <code>chartjs-node-canvas</code> estÃ¡ instalado</li>
<li>Ver logs del servidor Node.js</li>
<li>Verificar que los datos tienen el formato correcto</li>
</ol>
<h2>ğŸ“ Proyecto acadÃ©mico</h2>
<p>Desarrollado como parte del bootcamp de <strong>Data Science en TheBridge</strong>.</p>
<h3>DesafÃ­o de tripulaciones</h3>
<p>Proyecto colaborativo entre equipos de:</p>
<ul>
<li>ğŸ“Š <strong>Data Science</strong> - AnÃ¡lisis y modelo SQL</li>
<li>ğŸ’» <strong>Full Stack</strong> - IntegraciÃ³n frontend/backend</li>
<li>ğŸ”’ <strong>Cybersecurity</strong> - Seguridad y validaciÃ³n</li>
</ul>
<h3>Objetivos del proyecto</h3>
<ul>
<li>âœ… Aplicar conocimientos de bases de datos SQL</li>
<li>âœ… Integrar IA (LLMs) para procesamiento de lenguaje natural</li>
<li>âœ… Crear APIs REST profesionales</li>
<li>âœ… Generar visualizaciones dinÃ¡micas</li>
<li>âœ… Trabajo en equipo multidisciplinar</li>
</ul>
<h2>ğŸ“š Aprendizajes clave</h2>
<ul>
<li><strong>Model Context Protocol (MCP)</strong>: IntegraciÃ³n con herramientas de IA</li>
<li><strong>Prompt Engineering</strong>: DiseÃ±o de prompts para generaciÃ³n SQL</li>
<li><strong>API Design</strong>: Arquitectura modular y escalable</li>
<li><strong>Data Visualization</strong>: GeneraciÃ³n dinÃ¡mica de grÃ¡ficos</li>
<li><strong>DevOps</strong>: Manejo de entornos, dependencias y deploy</li>
</ul>
<h2>ğŸ” Seguridad</h2>
<ul>
<li>âœ… Variables sensibles en <code>.env</code> (no en Git)</li>
<li>âœ… ValidaciÃ³n estricta de SQL (solo SELECT)</li>
<li>âœ… PrevenciÃ³n de inyecciÃ³n SQL</li>
<li>âœ… CORS configurado correctamente</li>
<li>âœ… Timeout en peticiones</li>
</ul>
<h2>ğŸš€ PrÃ³ximas mejoras</h2>
<ul>
<li>[ ] Deploy en producciÃ³n (Render/Railway)</li>
<li>[ ] Frontend React para interfaz visual</li>
<li>[ ] AutenticaciÃ³n de usuarios</li>
<li>[ ] Cache de consultas frecuentes</li>
<li>[ ] Tests automatizados</li>
<li>[ ] CI/CD con GitHub Actions</li>
<li>[ ] Soporte para mÃ¡s modelos LLM</li>
<li>[ ] Exportar grÃ¡ficos en mÃºltiples formatos</li>
</ul>
<h2>ğŸ¤ Contribuciones</h2>
<p>Las contribuciones son bienvenidas. Por favor:</p>
<ol>
<li>Fork el proyecto</li>
<li>Crea una rama para tu feature (<code>git checkout -b feature/AmazingFeature</code>)</li>
<li>Commit tus cambios (<code>git commit -m 'Add some AmazingFeature'</code>)</li>
<li>Push a la rama (<code>git push origin feature/AmazingFeature</code>)</li>
<li>Abre un Pull Request</li>
</ol>
<h2>ğŸ‘¤ Autores</h2>
<p><strong>Miguel de la Torre, Luna PÃ©rez Troncoso, Ãlvaro MartÃ­nez, Rosenila Vega, Jose Vila, Juan Pablo Rizzi, Alejandro Cerro </strong></p>
<ul>
<li>GitHub: <a href="https://github.com/migueljdlt">@migueljdlt</a></li>
<li>Proyecto: <a href="https://github.com/migueljdlt/Archivo-Desaf-o-DATA-SCIENCE">Archivo-Desaf-o-DATA-SCIENCE</a></li>
</ul>
<h2>ğŸ“ Licencia</h2>
<p>Este proyecto es de cÃ³digo abierto bajo la licencia MIT.</p>
<h2>ğŸ™ Agradecimientos</h2>
<ul>
<li><strong>TheBridge</strong> - Por el bootcamp y el desafÃ­o</li>
<li><strong>Anthropic</strong> - Por el protocolo MCP</li>
<li><strong>Ollama</strong> - Por facilitar el uso de LLMs locales</li>
<li><strong>CompaÃ±eros de bootcamp</strong> - Por la colaboraciÃ³n</li>
</ul>
<hr>
<p>â­ Si este proyecto te fue Ãºtil, considera darle una estrella en GitHub</p></article>
    </section>






</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#DB_CONFIG">DB_CONFIG</a></li><li><a href="global.html#OLLAMA_CONFIG">OLLAMA_CONFIG</a></li><li><a href="global.html#SCHEMA_DESCRIPCION">SCHEMA_DESCRIPCION</a></li><li><a href="global.html#crearApp">crearApp</a></li><li><a href="global.html#express">express</a></li><li><a href="global.html#https">https</a></li><li><a href="global.html#prepararDatosParaGrafico">prepararDatosParaGrafico</a></li><li><a href="global.html#validarSQL">validarSQL</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Wed Dec 17 2025 11:14:43 GMT+0100 (hora estÃ¡ndar de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>